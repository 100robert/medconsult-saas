# ğŸ”„ MedConsult SaaS - Flujos de InteracciÃ³n

Este documento ilustra los flujos mÃ¡s importantes del sistema de forma visual y paso a paso.

---

## ğŸ“‹ Ãndice
1. [Flujo de Registro de Paciente](#1-flujo-de-registro-de-paciente)
2. [Flujo de Login](#2-flujo-de-login)
3. [Flujo de CreaciÃ³n de Cita](#3-flujo-de-creaciÃ³n-de-cita)
4. [Flujo de Consulta MÃ©dica](#4-flujo-de-consulta-mÃ©dica)
5. [Flujo de Refresh Token](#5-flujo-de-refresh-token)
6. [Flujo de Registro de MÃ©dico (Admin)](#6-flujo-de-registro-de-mÃ©dico-admin)

---

## 1. Flujo de Registro de Paciente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO  â”‚         â”‚ FRONTEND â”‚         â”‚ GATEWAY â”‚         â”‚   AUTH   â”‚
â”‚ (Pacienteâ”‚         â”‚ (Next.js)â”‚         â”‚  :3000  â”‚         â”‚  :3001   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 1. Llena formulario                    â”‚                    â”‚
      â”‚    de registro    â”‚                    â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 2. POST /api/auth/register             â”‚
      â”‚                   â”‚    { correo, contrasena, nombre, ... } â”‚
      â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ 3. Proxy to        â”‚
      â”‚                   â”‚                    â”‚    /auth/register  â”‚
      â”‚                   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 4. Validar datos
      â”‚                   â”‚                    â”‚                    â”‚    (Zod)
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 5. Hash password
      â”‚                   â”‚                    â”‚                    â”‚    (bcrypt)
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 6. Guardar en DB
      â”‚                   â”‚                    â”‚                    â”‚    (Prisma)
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 7. Generar JWT
      â”‚                   â”‚                    â”‚                    â”‚    (access + refresh)
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ { usuario, tokens }â”‚
      â”‚                   â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ { success, data }  â”‚                    â”‚
      â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 8. Guardar tokens  â”‚                    â”‚
      â”‚                   â”‚    en cookies      â”‚                    â”‚
      â”‚                   â”‚    (accessToken,   â”‚                    â”‚
      â”‚                   â”‚     refreshToken)  â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 9. Redirigir a     â”‚                    â”‚
      â”‚                   â”‚    /dashboard      â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 10. Ver dashboard â”‚                    â”‚                    â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
```

**Resultado**:
- âœ… Usuario creado en DB con rol `PACIENTE`
- âœ… ContraseÃ±a hasheada guardada
- âœ… Access token y refresh token generados
- âœ… Tokens guardados en cookies
- âœ… Usuario autenticado automÃ¡ticamente

---

## 2. Flujo de Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO  â”‚         â”‚ FRONTEND â”‚         â”‚ GATEWAY â”‚         â”‚   AUTH   â”‚
â”‚          â”‚         â”‚          â”‚         â”‚         â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 1. Ingresa        â”‚                    â”‚                    â”‚
      â”‚    email/password â”‚                    â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 2. POST /api/auth/login                â”‚
      â”‚                   â”‚    { correo, contrasena }              â”‚
      â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ 3. Proxy           â”‚
      â”‚                   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 4. Buscar usuario
      â”‚                   â”‚                    â”‚                    â”‚    por correo
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 5. Comparar password
      â”‚                   â”‚                    â”‚                    â”‚    bcrypt.compare()
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ 6. Si OK, generar
      â”‚                   â”‚                    â”‚                    â”‚    JWT tokens
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ { usuario, tokens }â”‚
      â”‚                   â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ { success, data }  â”‚                    â”‚
      â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 7. Guardar cookies â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 8. Guardar user en â”‚                    â”‚
      â”‚                   â”‚    Zustand store   â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 9. Redirect segÃºn  â”‚                    â”‚
      â”‚                   â”‚    rol:            â”‚                    â”‚
      â”‚                   â”‚    - PACIENTE â†’    â”‚                    â”‚
      â”‚                   â”‚      /dashboard    â”‚                    â”‚
      â”‚                   â”‚    - MEDICO â†’      â”‚                    â”‚
      â”‚                   â”‚      /dashboard    â”‚                    â”‚
      â”‚                   â”‚    - ADMIN â†’       â”‚                    â”‚
      â”‚                   â”‚      /dashboard    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 10. Ver dashboard â”‚                    â”‚                    â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
```

**Validaciones**:
- âŒ Usuario no existe â†’ Error 401
- âŒ Password incorrecto â†’ Error 401
- âŒ Usuario inactivo â†’ Error 403
- âœ… Todo OK â†’ Tokens + Redirect

---

## 3. Flujo de CreaciÃ³n de Cita

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PACIENTE â”‚    â”‚ FRONTEND â”‚    â”‚ GATEWAY â”‚    â”‚  USERS   â”‚    â”‚ APPOINTMENTSâ”‚
â”‚          â”‚    â”‚          â”‚    â”‚         â”‚    â”‚  :3002   â”‚    â”‚    :3003    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚ 1. Buscar mÃ©dicos            â”‚              â”‚                  â”‚
      â”‚    disponiblesâ”‚               â”‚              â”‚                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚ GET /api/medicos/disponibles â”‚                  â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚ Proxy        â”‚                  â”‚
      â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚ Query DB         â”‚
      â”‚              â”‚               â”‚              â”‚ (mÃ©dicos activos)â”‚
      â”‚              â”‚               â”‚ [mÃ©dicos]    â”‚                  â”‚
      â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚              â”‚ [mÃ©dicos]     â”‚              â”‚                  â”‚
      â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚ 2. Lista de  â”‚               â”‚              â”‚                  â”‚
      â”‚    mÃ©dicos   â”‚               â”‚              â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚ 3. Seleccionar               â”‚              â”‚                  â”‚
      â”‚    mÃ©dico y fecha            â”‚              â”‚                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚ GET /api/medicos/:id/disponibilidad            â”‚
      â”‚              â”‚    ?fecha=2024-12-10         â”‚                  â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚ Proxy        â”‚                  â”‚
      â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚ Query disponibilidad
      â”‚              â”‚               â”‚ [horarios]   â”‚                  â”‚
      â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚              â”‚ [horarios]    â”‚              â”‚                  â”‚
      â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚ 4. Horarios  â”‚               â”‚              â”‚                  â”‚
      â”‚    disponibles               â”‚              â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚ 5. Seleccionar               â”‚              â”‚                  â”‚
      â”‚    hora y crear              â”‚              â”‚                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚ POST /api/citas              â”‚                  â”‚
      â”‚              â”‚ { medicoId, fechaHora,       â”‚                  â”‚
      â”‚              â”‚   motivoConsulta }           â”‚                  â”‚
      â”‚              â”‚ + JWT Token                  â”‚                  â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚ Verify JWT   â”‚                  â”‚
      â”‚              â”‚               â”‚ Extract userId                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚ Proxy            â”‚
      â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚  Validar horario â”‚
      â”‚              â”‚               â”‚              â”‚  disponible      â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚  Crear cita en DBâ”‚
      â”‚              â”‚               â”‚              â”‚  Estado: PENDIENTE
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚  Emit event:     â”‚
      â”‚              â”‚               â”‚              â”‚  "cita_creada"   â”‚
      â”‚              â”‚               â”‚              â”‚  (RabbitMQ)      â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚ { cita }         â”‚
      â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚ { cita }      â”‚              â”‚                  â”‚
      â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚ 6. Cita creada               â”‚              â”‚                  â”‚
      â”‚    exitosamente              â”‚              â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚              â”‚               â”‚              â”‚                  â”‚
      â”‚                          (Notification Service escucha evento  â”‚
      â”‚                           y envÃ­a email de confirmaciÃ³n)       â”‚
```

**Validaciones**:
- âœ… Usuario autenticado (JWT)
- âœ… MÃ©dico existe y estÃ¡ activo
- âœ… Horario disponible
- âœ… Fecha no es pasada
- âœ… Usuario es PACIENTE

**Resultado**:
- âœ… Cita creada con estado `PENDIENTE`
- âœ… Evento emitido a RabbitMQ
- âœ… Email de confirmaciÃ³n enviado

---

## 4. Flujo de Consulta MÃ©dica

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEDICO  â”‚    â”‚ FRONTEND â”‚    â”‚ GATEWAY â”‚    â”‚ CONSULTATIONSâ”‚
â”‚          â”‚    â”‚          â”‚    â”‚         â”‚    â”‚    :3004     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚              â”‚               â”‚                 â”‚
      â”‚ 1. Ver cita  â”‚               â”‚                 â”‚
      â”‚    de hoy    â”‚               â”‚                 â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                 â”‚
      â”‚              â”‚ GET /api/citas?fecha=hoy        â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (Ver flujo anterior)
      â”‚              â”‚               â”‚                 â”‚
      â”‚ [citas]      â”‚               â”‚                 â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚ 2. Iniciar   â”‚               â”‚                 â”‚
      â”‚    consulta  â”‚               â”‚                 â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚ PATCH /api/citas/:id            â”‚
      â”‚              â”‚ { estado: "EN_CURSO" }          â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
      â”‚              â”‚               â”‚ (Appointments Service)
      â”‚              â”‚               â”‚                 â”‚
      â”‚ Cita iniciadaâ”‚               â”‚                 â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚ 3. Realizar  â”‚               â”‚                 â”‚
      â”‚    consulta  â”‚               â”‚                 â”‚
      â”‚    (WebRTC)  â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚ 4. Crear     â”‚               â”‚                 â”‚
      â”‚    diagnÃ³stico               â”‚                 â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚ POST /api/consultas             â”‚
      â”‚              â”‚ { citaId, diagnostico,          â”‚
      â”‚              â”‚   tratamiento, receta }         â”‚
      â”‚              â”‚ + JWT (rol: MEDICO)             â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
      â”‚              â”‚               â”‚ Verify JWT      â”‚
      â”‚              â”‚               â”‚ Check role      â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚ Proxy           â”‚
      â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚ Validar:
      â”‚              â”‚               â”‚                 â”‚ - Cita existe
      â”‚              â”‚               â”‚                 â”‚ - Es su cita
      â”‚              â”‚               â”‚                 â”‚ - Estado vÃ¡lido
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚ Crear consulta
      â”‚              â”‚               â”‚                 â”‚ Guardar receta
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚ Actualizar cita
      â”‚              â”‚               â”‚                 â”‚ â†’ COMPLETADA
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚                 â”‚ Emit event:
      â”‚              â”‚               â”‚                 â”‚ "consulta_finalizada"
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚               â”‚ { consulta }    â”‚
      â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚              â”‚               â”‚                 â”‚
      â”‚              â”‚ { consulta }  â”‚                 â”‚
      â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
      â”‚              â”‚               â”‚                 â”‚
      â”‚ Consulta     â”‚               â”‚                 â”‚
      â”‚ guardada     â”‚               â”‚                 â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                 â”‚
```

**Resultado**:
- âœ… Consulta creada con diagnÃ³stico y receta
- âœ… Cita marcada como `COMPLETADA`
- âœ… NotificaciÃ³n al paciente
- âœ… Receta disponible para descarga

---

## 5. Flujo de Refresh Token

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND â”‚         â”‚   API    â”‚         â”‚ GATEWAY â”‚         â”‚   AUTH   â”‚
â”‚  (Axios  â”‚         â”‚ Request  â”‚         â”‚         â”‚         â”‚          â”‚
â”‚Interceptor)        â”‚          â”‚         â”‚         â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 1. Hacer peticiÃ³n â”‚                    â”‚                    â”‚
      â”‚    con accessTokenâ”‚                    â”‚                    â”‚
      â”‚    (expirado)     â”‚                    â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
      â”‚                   â”‚ GET /api/citas     â”‚                    â”‚
      â”‚                   â”‚ Authorization: Bearer <expired_token>   â”‚
      â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ Verify JWT         â”‚
      â”‚                   â”‚                    â”‚ â†’ Token expired    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ 401 Unauthorized   â”‚                    â”‚
      â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 401 Unauthorized  â”‚                    â”‚                    â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 2. Interceptor    â”‚                    â”‚                    â”‚
      â”‚    detecta 401    â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 3. POST /api/auth/refresh              â”‚                    â”‚
      â”‚    { refreshToken }                    â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ Proxy              â”‚
      â”‚                   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ Verificar refresh
      â”‚                   â”‚                    â”‚                    â”‚ token en DB
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚ Generar nuevo
      â”‚                   â”‚                    â”‚                    â”‚ access token
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ { accessToken,     â”‚
      â”‚                   â”‚                    â”‚   refreshToken }   â”‚
      â”‚                   â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ { tokens }        â”‚                    â”‚                    â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 4. Guardar nuevos â”‚                    â”‚                    â”‚
      â”‚    tokens en cookies                   â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 5. Reintentar     â”‚                    â”‚                    â”‚
      â”‚    peticiÃ³n original                   â”‚                    â”‚
      â”‚    con nuevo tokenâ”‚                    â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
      â”‚                   â”‚ GET /api/citas     â”‚                    â”‚
      â”‚                   â”‚ Authorization: Bearer <new_token>       â”‚
      â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚ Verify JWT âœ…      â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚                   â”‚ { citas }          â”‚                    â”‚
      â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ { citas }         â”‚                    â”‚                    â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
      â”‚                   â”‚                    â”‚                    â”‚
      â”‚ 6. Mostrar datos  â”‚                    â”‚                    â”‚
```

**Todo automÃ¡tico**:
- âœ… Usuario no se da cuenta
- âœ… No necesita volver a hacer login
- âœ… Experiencia fluida

**Si refresh token tambiÃ©n expirÃ³**:
- âŒ Redirigir a `/login`
- âŒ Limpiar cookies

---

## 6. Flujo de Registro de MÃ©dico (Admin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN   â”‚    â”‚ FRONTEND â”‚    â”‚ GATEWAY â”‚    â”‚   AUTH   â”‚    â”‚  USERS  â”‚
â”‚          â”‚    â”‚ (Dashboard)   â”‚         â”‚    â”‚  :3001   â”‚    â”‚  :3002  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚ 1. Ir a      â”‚               â”‚              â”‚                â”‚
      â”‚ /dashboard/  â”‚               â”‚              â”‚                â”‚
      â”‚  doctors     â”‚               â”‚              â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚ 2. Clic en   â”‚               â”‚              â”‚                â”‚
      â”‚    "Registrarâ”‚               â”‚              â”‚                â”‚
      â”‚    MÃ©dico"   â”‚               â”‚              â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚ 3. Modal con â”‚               â”‚              â”‚                â”‚
      â”‚    formularioâ”‚               â”‚              â”‚                â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚ 4. Llenar:   â”‚               â”‚              â”‚                â”‚
      â”‚    - Email   â”‚               â”‚              â”‚                â”‚
      â”‚    - Nombre  â”‚               â”‚              â”‚                â”‚
      â”‚    - Apellidoâ”‚               â”‚              â”‚                â”‚
      â”‚    - Passwordâ”‚               â”‚              â”‚                â”‚
      â”‚    - Especialidad            â”‚              â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚ POST /api/auth/admin/create-user              â”‚
      â”‚              â”‚ { correo, contrasena, nombre, apellido,       â”‚
      â”‚              â”‚   rol: "MEDICO" }            â”‚                â”‚
      â”‚              â”‚ + JWT (rol: ADMIN)           â”‚                â”‚
      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚ Verify JWT   â”‚                â”‚
      â”‚              â”‚               â”‚ Check role = ADMIN            â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚ Proxy        â”‚                â”‚
      â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚ Validar datos  â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚ Hash password  â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚ Crear usuario  â”‚
      â”‚              â”‚               â”‚              â”‚ rol = MEDICO   â”‚
      â”‚              â”‚               â”‚              â”‚ correoVerificado = true
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚ Obtener userId â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚â”€â”€â”€â”€â”€â”€â”         â”‚
      â”‚              â”‚               â”‚              â”‚      â”‚ Call    â”‚
      â”‚              â”‚               â”‚              â”‚      â”‚ Users   â”‚
      â”‚              â”‚               â”‚              â”‚      â”‚ Service â”‚
      â”‚              â”‚               â”‚              â”‚      â”‚         â”‚
      â”‚              â”‚               â”‚              â”‚â—„â”€â”€â”€â”€â”€â”˜         â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚             Crear
      â”‚              â”‚               â”‚              â”‚             perfil
      â”‚              â”‚               â”‚              â”‚             mÃ©dico
      â”‚              â”‚               â”‚              â”‚             con
      â”‚              â”‚               â”‚              â”‚             especialidad
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚ { usuario }  â”‚                â”‚
      â”‚              â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚              â”‚ { success, usuario }         â”‚                â”‚
      â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚ 5. Ã‰xito:    â”‚               â”‚              â”‚                â”‚
      â”‚    "MÃ©dico   â”‚               â”‚              â”‚                â”‚
      â”‚    registrado"               â”‚              â”‚                â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚              â”‚                â”‚
      â”‚              â”‚               â”‚              â”‚                â”‚
      â”‚ 6. Email     â”‚               â”‚              â”‚                â”‚
      â”‚    enviado alâ”‚               â”‚              â”‚                â”‚
      â”‚    mÃ©dico conâ”‚               â”‚              â”‚                â”‚
      â”‚    credenciales              â”‚              â”‚                â”‚
```

**Importante**:
- âœ… Solo ADMIN puede crear mÃ©dicos
- âœ… Email del mÃ©dico es verificado automÃ¡ticamente
- âœ… Se crea usuario + perfil de mÃ©dico
- âœ… MÃ©dico recibe email con instrucciones
- âŒ MÃ©dicos NO pueden auto-registrarse

---

## ğŸ” Resumen de AutenticaciÃ³n

### Access Token
- **DuraciÃ³n**: 1 hora
- **Uso**: Cada peticiÃ³n autenticada
- **Storage**: Cookie `accessToken`
- **Header**: `Authorization: Bearer <token>`

### Refresh Token
- **DuraciÃ³n**: 7 dÃ­as
- **Uso**: Renovar access token
- **Storage**: Cookie `refreshToken`
- **Endpoint**: `POST /api/auth/refresh-token`

### Roles
```
ADMIN
  â”œâ”€ Todos los permisos
  â”œâ”€ Crear mÃ©dicos
  â”œâ”€ Ver auditorÃ­a
  â””â”€ Gestionar usuarios

MEDICO
  â”œâ”€ Ver sus citas
  â”œâ”€ Crear consultas
  â”œâ”€ Gestionar disponibilidad
  â””â”€ Ver sus pacientes

PACIENTE
  â”œâ”€ Crear citas
  â”œâ”€ Ver su historial
  â”œâ”€ Crear reseÃ±as
  â””â”€ Ver su perfil
```

---

## ğŸš¦ Estados de Cita

```
PENDIENTE
   â†“ (MÃ©dico confirma)
CONFIRMADA
   â†“ (MÃ©dico inicia)
EN_CURSO
   â†“ (MÃ©dico finaliza)
COMPLETADA

   Cualquier estado â†’ CANCELADA (paciente/mÃ©dico)
```

---

## ğŸ“¨ Eventos (RabbitMQ)

```
Cita Creada
   â†’ Notification Service
      â†’ Email a paciente: "Cita registrada"
      â†’ Email a mÃ©dico: "Nueva cita pendiente"

Cita Confirmada
   â†’ Notification Service
      â†’ Email a paciente: "Cita confirmada"

Consulta Finalizada
   â†’ Notification Service
      â†’ Email a paciente: "Receta disponible"
   â†’ Payment Service
      â†’ Generar factura

Usuario Registrado
   â†’ Notification Service
      â†’ Email de bienvenida
      â†’ Email de verificaciÃ³n
```

---

## ğŸ“Š Diagrama Completo del Sistema

```
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   FRONTEND (Next.js)   â”‚
                     â”‚       Port 3010        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTP/REST
                                 â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    API GATEWAY         â”‚
                     â”‚       Port 3000        â”‚
                     â”‚                        â”‚
                     â”‚  - JWT Verification    â”‚
                     â”‚  - Rate Limiting       â”‚
                     â”‚  - CORS                â”‚
                     â”‚  - Routing/Proxy       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚               â”‚               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚  Auth :3001    â”‚ â”‚ Users :3002 â”‚ â”‚ Appts :3003â”‚
      â”‚                â”‚ â”‚             â”‚ â”‚            â”‚
      â”‚ - Login        â”‚ â”‚ - Profiles  â”‚ â”‚ - Create   â”‚
      â”‚ - Register     â”‚ â”‚ - Doctors   â”‚ â”‚ - List     â”‚
      â”‚ - JWT          â”‚ â”‚ - Patients  â”‚ â”‚ - Cancel   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚                â”‚              â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    PostgreSQL DB      â”‚
                â”‚      Port 5432        â”‚
                â”‚                       â”‚
                â”‚  Tables:              â”‚
                â”‚  - Usuario            â”‚
                â”‚  - Cita               â”‚
                â”‚  - Consulta           â”‚
                â”‚  - Medico             â”‚
                â”‚  - Paciente           â”‚
                â”‚  - Pago               â”‚
                â”‚  - ...                â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         MESSAGE BROKER                â”‚
    â”‚                                       â”‚
    â”‚  RabbitMQ :5672, :15672               â”‚
    â”‚                                       â”‚
    â”‚  Queues:                              â”‚
    â”‚  - notifications                      â”‚
    â”‚  - emails                             â”‚
    â”‚  - payments                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           CACHE                       â”‚
    â”‚                                       â”‚
    â”‚  Redis :6379                          â”‚
    â”‚                                       â”‚
    â”‚  - Session cache                      â”‚
    â”‚  - Rate limit counters                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ConclusiÃ³n

Estos flujos muestran cÃ³mo **cada componente** del sistema interactÃºa de forma **coordinada** y **segura** para proporcionar una experiencia completa de telemedicina.

**Puntos clave**:
- âœ… SeparaciÃ³n clara de responsabilidades
- âœ… Seguridad en cada capa (JWT, roles, validaciÃ³n)
- âœ… ComunicaciÃ³n asÃ­ncrona con eventos (RabbitMQ)
- âœ… Experiencia de usuario fluida (refresh tokens automÃ¡tico)
- âœ… Arquitectura escalable

---

**Documentos relacionados**:
- `.agent/ARQUITECTURA.md` - Arquitectura completa
- `.agent/INICIO_RAPIDO.md` - GuÃ­a de inicio
- `.agent/RESUMEN_EJECUTIVO.md` - Resumen del proyecto
